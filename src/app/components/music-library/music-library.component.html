<div class="library-container">
  <!-- Header Section -->
  <header class="library-header">
    <h1>Music Library</h1>
    <button mat-raised-button color="primary" (click)="toggleEditMode()">
      <mat-icon>{{ isEditMode ? 'lock' : 'edit' }}</mat-icon>
      {{ isEditMode ? 'Lock Order' : 'Edit Order' }}
    </button>
  </header>

  <!-- Filters Section -->
  <section class="filters-section">
    <form [formGroup]="filterForm" class="filters-container">
      <!-- Search Field -->
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search tracks</mat-label>
        <input matInput formControlName="search" placeholder="Search by title or artist">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <div class="filter-group">
        <!-- Category Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Category</mat-label>
          <mat-select formControlName="category">
            <mat-option>All Categories</mat-option>
            <mat-option *ngFor="let category of categories" [value]="category">
              {{category | titlecase}}
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>category</mat-icon>
        </mat-form-field>

        <!-- Duration Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Duration</mat-label>
          <mat-select formControlName="duration">
            <mat-option>Any Length</mat-option>
            <mat-option *ngFor="let range of durationRanges" [value]="range.value">
              {{range.label}}
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>timer</mat-icon>
        </mat-form-field>

        <!-- Year Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Release Year</mat-label>
          <mat-select formControlName="year">
            <mat-option>Any Year</mat-option>
            <mat-option *ngFor="let year of years" [value]="year">
              {{year}}
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>calendar_today</mat-icon>
        </mat-form-field>
      </div>
    </form>
  </section>

  <!-- Tracks Grid Section -->
  <section class="tracks-section">
    <div class="tracks-grid" cdkDropList (cdkDropListDropped)="onDrop($event)" [cdkDropListDisabled]="!isEditMode">
      <div *ngFor="let track of filteredTracks$ | async" 
           class="track-item" 
           cdkDrag
           [cdkDragDisabled]="!isEditMode">
        
        <div class="track-card" [class.edit-mode]="isEditMode">
          <!-- Drag Handle -->
          <div class="drag-indicator" cdkDragHandle *ngIf="isEditMode">
            <mat-icon>drag_indicator</mat-icon>
          </div>

          <!-- Album Art & Quick Actions -->
          <div class="album-art" (click)="viewTrackDetails(track, $event)">
            <img [src]="track.thumbnailUrl || 'assets/default-cover.png'" [alt]="track.title">
            <div class="quick-actions">
              <button mat-mini-fab color="primary" (click)="playTrack(track, $event)">
                <mat-icon>play_arrow</mat-icon>
              </button>
            </div>
          </div>

          <!-- Track Content -->
          <div class="track-content">
            <!-- Main Info -->
            <div class="main-info">
              <div class="title-artist" (click)="viewTrackDetails(track, $event)" style="cursor: pointer;">
                <h3 class="title" [matTooltip]="track.title">{{ track.title }}</h3>
                <p class="artist" [matTooltip]="track.artist">{{ track.artist }}</p>
              </div>
              <span class="category-badge" [class]="track.category">
                {{ track.category | titlecase }}
              </span>
            </div>

            <!-- Track Stats -->
            <div class="track-stats">
              <div class="stat">
                <mat-icon>schedule</mat-icon>
                <span>{{ track.duration | duration }}</span>
              </div>
              <div class="stat" *ngIf="track.releaseDate">
                <mat-icon>event</mat-icon>
                <span>{{ track.releaseDate | date:'yyyy' }}</span>
              </div>
            </div>

            <!-- Action Bar -->
            <div class="action-bar">
              <div class="action-buttons">
                <button mat-icon-button (click)="viewTrackDetails(track, $event)" 
                        matTooltip="View Details" color="primary">
                  <mat-icon>info</mat-icon>
                </button>
                <button mat-icon-button (click)="deleteTrack(track.id, track.title)" 
                        matTooltip="Delete Track" color="warn">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Drag Preview -->
        <div class="track-placeholder" *cdkDragPlaceholder>
          <mat-icon>album</mat-icon>
          {{track.title}}
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="(filteredTracks$ | async)?.length === 0" class="empty-state">
      <mat-icon>library_music</mat-icon>
      <h2>No tracks found</h2>
      <p>Try adjusting your filters or add some new tracks</p>
    </div>

    <!-- Add this after the tracks grid -->
    <mat-paginator
      [length]="totalTracks$ | async"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      [pageIndex]="currentPage"
      (page)="onPageChange($event)"
      aria-label="Select page">
    </mat-paginator>
  </section>
</div>